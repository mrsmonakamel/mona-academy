<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ms. Mona | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #6c5ce7; --dark: #4834d4; --bg: #f4f4f9; --danger: #ff7675; --success: #2ecc71; --whatsapp: #25d366; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); padding: 20px; color: #333; }
        
        #adminDashboard { display: none; max-width: 1100px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); border-right: 5px solid var(--main); }
        
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-menu button { padding: 12px 25px; border: none; border-radius: 10px; cursor: pointer; font-family: 'Cairo'; font-weight: bold; background: #fff; transition: 0.3s; }
        .tab-menu button.active { background: var(--main); color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: right; border-bottom: 1px solid #eee; }
        th { background: var(--main); color: white; }

        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-top: 5px; font-family: 'Cairo'; }
        
        .status-btn { padding: 5px 10px; border-radius: 5px; border: none; color: white; cursor: pointer; font-size: 0.8rem; font-family: 'Cairo'; }
        
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; align-items: center; justify-content: center; }
        .modal-body { background: white; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; }

        .wa-link { color: var(--whatsapp); text-decoration: none; font-weight: bold; }
        .wa-link:hover { text-decoration: underline; }
    </style>
</head>
<body>

    <div id="loginArea" style="text-align: center; margin-top: 100px;">
        <h2 style="color:var(--main)">Ø¯Ø®ÙˆÙ„ Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ğŸ”</h2>
        <div style="max-width: 350px; margin: 20px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.05);">
            <input type="email" id="adminEmail" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
            <input type="password" id="adminPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            <button onclick="adminLogin()" style="width: 100%; padding: 12px; background: var(--main); color: white; border: none; border-radius: 10px; margin-top: 15px; cursor: pointer; font-weight: bold; font-family: 'Cairo';">Ø¯Ø®ÙˆÙ„</button>
        </div>
    </div>

    <div id="adminDashboard">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
            <h1 style="color: var(--dark);">Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ms. Mona ğŸ’</h1>
            <button onclick="adminLogout()" class="status-btn" style="background: var(--danger); padding: 10px 20px;">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        </div>

        <div class="tab-menu">
            <button class="active" onclick="showTab('studentsTab', this)">Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</button>
            <button onclick="showTab('coursesTab', this)">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button>
            <button onclick="showTab('quizzesTab', this)">Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</button>
            <button onclick="showTab('resultsTab', this)">Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
        </div>

        <div id="studentsTab" class="tab-content">
            <div class="card">
                <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ØµÙ</th>
                            <th>ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="studentsTableBody"></tbody>
                </table>
            </div>
        </div>

        <div id="coursesTab" class="tab-content" style="display:none;">
            <div class="card">
                <h3>Ø¥Ø¶Ø§ÙØ© ÙƒÙˆØ±Ø³ (Ù…Ø¬Ù„Ø¯) Ø¬Ø¯ÙŠØ¯</h3>
                <input type="text" id="courseName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³ (Ù…Ø«Ù„Ø§Ù‹: Ø§Ù„ØµÙ Ø§Ù„Ø³Ø§Ø¯Ø³ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ)">
                <input type="text" id="courseImg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ÙƒÙˆØ±Ø³">
                <button onclick="addNewCourse()" style="margin-top:10px; background:var(--success); color:white; border:none; padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:bold; font-family:'Cairo';">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯</button>
            </div>
            
            <div class="card">
                <h3>Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¯Ø§Ø®Ù„ ÙƒÙˆØ±Ø³</h3>
                <select id="targetCourseSelect"></select>
                <input type="text" id="videoTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
                <input type="text" id="videoLink" placeholder="Ø±Ø§Ø¨Ø· ÙÙŠØ¯ÙŠÙˆ Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨">
                <button onclick="addVideoToCourse()" style="margin-top:10px; background:var(--main); color:white; border:none; padding:10px 20px; border-radius:10px; cursor:pointer; font-weight:bold; font-family:'Cairo';">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
            </div>
        </div>

        <div id="quizzesTab" class="tab-content" style="display:none;">
            <div class="card">
                <h3>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù…ØªØ­Ø§Ù† Ø¬Ø¯ÙŠØ¯</h3>
                <select id="examCourseSelect" onchange="loadVideosForExam()"></select>
                <select id="videoRelSelect">
                    <option value="all">Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„ (Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)</option>
                </select>
                <input type="text" id="quizName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                <hr style="margin:20px 0; opacity:0.2;">
                <div id="questionsArea"></div>
                <button onclick="addQuestionField()" style="background:#eee; border:1px dashed #999; width:100%; padding:10px; cursor:pointer; font-family:'Cairo';">+ Ø¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„</button>
                <button onclick="saveQuiz()" style="margin-top:20px; background:var(--success); color:white; width:100%; padding:15px; border:none; border-radius:10px; font-weight:bold; cursor:pointer; font-family:'Cairo';">Ù†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</button>
            </div>
        </div>

        <div id="resultsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h3>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                            <th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th>
                            <th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, get, set, push, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8KQAQgu4nIiomoDpoTLnBz_uAtab63sY",
            authDomain: "monaacademy-cd983.firebaseapp.com",
            databaseURL: "https://monaacademy-cd983-default-rtdb.firebaseio.com",
            projectId: "monaacademy-cd983",
            storageBucket: "monaacademy-cd983.appspot.com",
            appId: "1:410646694761:web:bea49c51d3b0ff5eb9cbf8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        const ADMIN_EMAIL = "mrsmonakamel6@gmail.com";

        onAuthStateChanged(auth, user => {
            if(user && user.email === ADMIN_EMAIL) {
                document.getElementById('loginArea').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadStudents();
                loadFoldersForSelects();
                loadResults();
            } else {
                document.getElementById('loginArea').style.display = 'block';
                document.getElementById('adminDashboard').style.display = 'none';
            }
        });

        window.adminLogin = () => {
            const e = document.getElementById('adminEmail').value;
            const p = document.getElementById('adminPass').value;
            signInWithEmailAndPassword(auth, e, p).catch(err => alert("Ø®Ø·Ø£: " + err.message));
        };

        window.adminLogout = () => signOut(auth);

        function loadStudents() {
            onValue(ref(db, 'students'), snapshot => {
                let html = "";
                snapshot.forEach(s => {
                    const data = s.val();
                    html += `<tr>
                        <td>${data.name}</td>
                        <td>${data.grade}</td>
                        <td>
                            <a href="https://wa.me/${data.whatsapp}" target="_blank" class="wa-link">
                                <i class="fab fa-whatsapp"></i> ${data.whatsapp}
                            </a>
                        </td>
                        <td>
                            <a href="https://wa.me/${data.parentPhone}" target="_blank" class="wa-link" style="color:var(--dark)">
                                <i class="fas fa-phone"></i> ${data.parentPhone || '---'}
                            </a>
                        </td>
                        <td><button onclick="del('students/${s.key}')" class="status-btn" style="background:var(--danger)">Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨</button></td>
                    </tr>`;
                });
                document.getElementById('studentsTableBody').innerHTML = html;
            });
        }

        function loadFoldersForSelects() {
            onValue(ref(db, 'folders'), snapshot => {
                let options = '<option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯ --</option>';
                snapshot.forEach(f => { options += `<option value="${f.key}">${f.val().name}</option>`; });
                document.getElementById('targetCourseSelect').innerHTML = options;
                document.getElementById('examCourseSelect').innerHTML = options;
            });
        }

        window.loadVideosForExam = async () => {
            const fId = document.getElementById('examCourseSelect').value;
            const vSelect = document.getElementById('videoRelSelect');
            vSelect.innerHTML = '<option value="all">Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„ (Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„)</option>';
            if(!fId) return;
            const snap = await get(ref(db, `folders/${fId}/videos`));
            snap.forEach(v => { vSelect.innerHTML += `<option value="${v.key}">${v.val().title}</option>`; });
        };

        window.addNewCourse = () => {
            const name = document.getElementById('courseName').value.trim();
            const img = document.getElementById('courseImg').value.trim();
            if(!name) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù…");
            push(ref(db, 'folders'), { name, img }).then(() => {
                alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯");
                document.getElementById('courseName').value = "";
                document.getElementById('courseImg').value = "";
            });
        };

        window.addVideoToCourse = () => {
            const fId = document.getElementById('targetCourseSelect').value;
            const title = document.getElementById('videoTitle').value.trim();
            const url = document.getElementById('videoLink').value.trim();
            if(!fId || !title || !url) return alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
            push(ref(db, `folders/${fId}/videos`), { title, url }).then(() => {
                alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
                document.getElementById('videoTitle').value = "";
                document.getElementById('videoLink').value = "";
            });
        };

        let qCount = 0;
        window.addQuestionField = () => {
            const area = document.getElementById('questionsArea');
            const div = document.createElement('div');
            div.className = "card";
            div.style = "background:#f9f9f9; border-right-color:#ccc;";
            div.innerHTML = `
                <input type="text" class="q-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px;">
                    <input type="text" class="optA" placeholder="Ø§Ø®ØªÙŠØ§Ø± A">
                    <input type="text" class="optB" placeholder="Ø§Ø®ØªÙŠØ§Ø± B">
                    <input type="text" class="optC" placeholder="Ø§Ø®ØªÙŠØ§Ø± C (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                    <input type="text" class="optD" placeholder="Ø§Ø®ØªÙŠØ§Ø± D (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
                </div>
                <select class="correct-opt" style="margin-top:10px; background:#fff;">
                    <option value="A">Ø§Ù„Ø§Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: A</option>
                    <option value="B">Ø§Ù„Ø§Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: B</option>
                    <option value="C">Ø§Ù„Ø§Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: C</option>
                    <option value="D">Ø§Ù„Ø§Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: D</option>
                </select>
            `;
            area.appendChild(div);
        };

        window.saveQuiz = () => {
            const fId = document.getElementById('examCourseSelect').value;
            const videoRel = document.getElementById('videoRelSelect').value;
            const quizName = document.getElementById('quizName').value.trim();
            const qDivs = document.querySelectorAll('#questionsArea .card');
            
            if(!fId || !quizName || qDivs.length === 0) return alert("Ø£ÙƒÙ…Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†");

            let questions = [];
            qDivs.forEach(div => {
                questions.push({
                    text: div.querySelector('.q-text').value,
                    options: {
                        A: div.querySelector('.optA').value,
                        B: div.querySelector('.optB').value,
                        C: div.querySelector('.optC').value || "-",
                        D: div.querySelector('.optD').value || "-"
                    },
                    correct: div.querySelector('.correct-opt').value
                });
            });

            push(ref(db, `quizzes/${fId}`), { name: quizName, videoRel, questions }).then(() => {
                alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­");
                document.getElementById('questionsArea').innerHTML = "";
                document.getElementById('quizName').value = "";
            });
        };

        function loadResults() {
            onValue(ref(db, 'results'), snapshot => {
                let html = "";
                snapshot.forEach(r => {
                    const d = r.val();
                    html += `<tr>
                        <td>${d.student}</td>
                        <td>${d.exam}</td>
                        <td style="font-weight:bold; color:var(--main)">${d.score}%</td>
                        <td>${d.date}</td>
                        <td><button onclick="del('results/${r.key}')" class="status-btn" style="background:var(--danger)">Ø­Ø°Ù</button></td>
                    </tr>`;
                });
                document.getElementById('resultsTableBody').innerHTML = html;
            });
        }

        window.showTab = (id, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display='none');
            document.getElementById(id).style.display='block';
            document.querySelectorAll('.tab-menu button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        window.del = (path) => {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ")) {
                remove(ref(db, path)).catch(err => alert("Ø®Ø·Ø£: " + err.message));
            }
        };

    </script>
</body>
</html>
