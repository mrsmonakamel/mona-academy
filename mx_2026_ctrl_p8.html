<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ms. Mona | Pro Admin Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --accent: #6c5ce7;
            --accent-light: #a29bfe;
            --dark: #2d3436;
            --success: #00b894;
            --danger: #ff7675;
            --bg: #f8f9fd;
            --glass: rgba(255, 255, 255, 0.9);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); color: var(--dark); overflow-x: hidden; }

        /* Sidebar & Layout */
        .wrapper { display: flex; min-height: 100vh; }
        .sidebar { width: 280px; background: var(--dark); color: white; padding: 30px 20px; transition: 0.3s; }
        .main-content { flex: 1; padding: 30px; }

        .logo { font-size: 1.5rem; font-weight: 900; margin-bottom: 40px; text-align: center; color: var(--accent-light); border-bottom: 1px solid #444; padding-bottom: 20px; }

        .nav-link { 
            display: flex; align-items: center; gap: 15px; padding: 15px; 
            border-radius: 12px; cursor: pointer; transition: 0.3s; margin-bottom: 8px;
            color: #dfe6e9; text-decoration: none;
        }
        .nav-link:hover, .nav-link.active { background: var(--accent); color: white; }

        /* Cards & Stats */
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.03); margin-bottom: 25px; border: 1px solid #f1f1f1; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        
        /* Form Styling */
        .form-group { margin-bottom: 20px; }
        label { display: block; font-weight: 700; margin-bottom: 8px; color: var(--dark); font-size: 0.9rem; }
        input, select, textarea { 
            width: 100%; padding: 12px 15px; border-radius: 12px; border: 2px solid #eee; 
            font-family: 'Cairo'; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--accent); background: #fcfcff; }

        .btn { 
            padding: 12px 25px; border: none; border-radius: 12px; cursor: pointer; 
            font-weight: 700; font-family: 'Cairo'; transition: 0.3s; display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-main { background: var(--accent); color: white; }
        .btn-outline { border: 2px solid var(--accent); color: var(--accent); background: transparent; }
        .btn-danger { background: #fff5f5; color: var(--danger); }

        /* Custom Table */
        .custom-table { width: 100%; border-collapse: collapse; }
        .custom-table th { text-align: right; padding: 15px; color: #b2bec3; font-size: 0.8rem; text-transform: uppercase; }
        .custom-table td { padding: 15px; border-bottom: 1px solid #f9f9f9; }
        .icon-box { width: 50px; height: 50px; border-radius: 12px; object-fit: cover; background: #eee; }

        /* Animation & Loading */
        #loader { position: fixed; inset: 0; background: white; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { padding: 15px; }
        }
    </style>
</head>
<body>

    <div id="loader">
        <div class="logo">MS. MONA ACADEMY</div>
        <i class="fas fa-circle-notch fa-spin fa-2x" style="color:var(--accent)"></i>
    </div>

    <div class="wrapper" id="adminDashboard" style="display: none;">
        <aside class="sidebar">
            <div class="logo">Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ø°ÙƒÙŠ</div>
            <div class="nav-link active" onclick="showSection('contentSection', this)"><i class="fas fa-photo-video"></i> Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰</div>
            <div class="nav-link" onclick="showSection('examSection', this)"><i class="fas fa-file-signature"></i> Ù…ØµÙ†Ø¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª</div>
            <div class="nav-link" onclick="showSection('studentSection', this)"><i class="fas fa-user-graduate"></i> Ø´Ø¤ÙˆÙ† Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            <div class="nav-link" onclick="showSection('reviewSection', this)"><i class="fas fa-comment-dots"></i> Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</div>
            <div style="margin-top: 50px; border-top: 1px solid #444; padding-top: 20px;">
                <div class="nav-link" onclick="adminLogout()" style="color: var(--danger);"><i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</div>
            </div>
        </aside>

        <main class="main-content">
            <header style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 style="font-weight: 900;">Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ğŸš€</h1>
                    <p id="currentDate" style="color: #636e72;"></p>
                </div>
                <div id="adminBadge" style="background: #e0dbff; color: var(--accent); padding: 8px 15px; border-radius: 30px; font-weight: 700;">
                    <i class="fas fa-check-circle"></i> Ø£Ø¯Ù…Ù†: Ù…Ù†Ù‰ ÙƒÙ…Ø§Ù„
                </div>
            </header>

            <section id="contentSection" class="admin-section">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
                    <div class="card">
                        <div class="card-header"><h3 id="courseFormTitle">Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯</h3></div>
                        <input type="hidden" id="editFolderId">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù„Ø¯ (Ø§Ù„ÙƒÙˆØ±Ø³)</label>
                            <input type="text" id="folderName" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø±Ø§Ø¬Ø¹Ø© Ù„ÙŠÙ„Ø© Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†">
                        </div>
                        <div class="form-group">
                            <label>Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ÙƒÙˆØ±Ø³ (Ø±ÙØ¹ ØµÙˆØ±Ø© Ù…Ø¨Ø§Ø´Ø±Ø©)</label>
                            <input type="file" id="folderFile" accept="image/*" style="padding: 5px; border: 1px dashed var(--accent);">
                        </div>
                        <button class="btn btn-main" onclick="saveFolder()" style="width: 100%;" id="saveFolderBtn">Ø­ÙØ¸ Ø§Ù„Ù…Ø¬Ù„Ø¯</button>
                    </div>

                    <div class="card">
                        <div class="card-header"><h3>Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h3></div>
                        <table class="custom-table">
                            <tbody id="foldersList"></tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 25px;">
                    <div class="card-header"><h3>Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ</h3></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <select id="videoFolderSelect"></select>
                        <input type="text" id="videoTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
                        <input type="text" id="videoUrl" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨">
                    </div>
                    <button class="btn btn-main" onclick="addVideo()" style="margin-top: 15px;">Ù†Ø´Ø± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
                </div>
            </section>

            <section id="examSection" class="admin-section" style="display: none;">
                <div class="card">
                    <div class="card-header"><h3>ØªØµÙ…ÙŠÙ… Ø§Ù…ØªØ­Ø§Ù† ØªÙØ§Ø¹Ù„ÙŠ</h3></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                        <select id="examFolderSelect" onchange="loadVideosForExam()"></select>
                        <select id="examVideoSelect"><option value="all">Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„ Ù„Ù„ÙƒÙˆØ±Ø³</option></select>
                    </div>
                    <input type="text" id="examTitle" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ù…Ø«Ù„Ø§Ù‹: Quiz 1)" style="margin-bottom: 20px;">
                    <div id="qBuilder"></div>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-outline" onclick="addQuestion('mcq')">+ Ø®ÙŠØ§Ø±Ø§Øª</button>
                        <button class="btn btn-outline" onclick="addQuestion('tf')">+ ØµØ­/Ø®Ø·Ø£</button>
                    </div>
                    <button class="btn btn-main" onclick="publishExam()" style="width: 100%; margin-top: 30px; height: 60px;">Ù†Ø´Ø± Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ù„Ù„Ø·Ù„Ø§Ø¨</button>
                </div>
            </section>

            <section id="studentSection" class="admin-section" style="display: none;">
                <div class="card">
                    <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                    <table class="custom-table">
                        <thead><tr><th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„ØµÙ</th><th>ÙˆØ§ØªØ³Ø§Ø¨</th><th>Ù†ØªØ§Ø¦Ø¬</th><th>Ø­Ø°Ù</th></tr></thead>
                        <tbody id="studentsList"></tbody>
                    </table>
                </div>
                <div class="card">
                    <h3>Ø³Ø¬Ù„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø£Ø®ÙŠØ±</h3>
                    <table class="custom-table">
                        <thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø§Ù„ØªÙˆÙ‚ÙŠØª</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr></thead>
                        <tbody id="resultsList"></tbody>
                    </table>
                </div>
            </section>

            <section id="reviewSection" class="admin-section" style="display: none;">
                <div class="card">
                    <h3>Ø¢Ø±Ø§Ø¡ ÙˆØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨</h3>
                    <div id="reviewsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 15px;"></div>
                </div>
            </section>

        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, remove, onValue, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8KQAQgu4nIiomoDpoTLnBz_uAtab63sY",
            authDomain: "monaacademy-cd983.firebaseapp.com",
            databaseURL: "https://monaacademy-cd983-default-rtdb.firebaseio.com",
            projectId: "monaacademy-cd983",
            storageBucket: "monaacademy-cd983.appspot.com",
            appId: "1:410646694761:web:bea49c51d3b0ff5eb9cbf8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        const ADMIN_EMAIL = "mrsmonakamel6@gmail.com";

        // Auth & Security
        onAuthStateChanged(auth, user => {
            if (user && user.email.toLowerCase() === ADMIN_EMAIL.toLowerCase()) {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'flex';
                initDashboard();
            } else {
                window.location.href = "index.html";
            }
        });

        function initDashboard() {
            document.getElementById('currentDate').innerText = new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            // Sync Folders
            onValue(ref(db, 'folders'), snap => {
                let html = "", opts = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù„Ø¯</option>';
                snap.forEach(f => {
                    const d = f.val();
                    opts += `<option value="${f.key}">${d.name}</option>`;
                    html += `<tr>
                        <td><img src="${d.img || ''}" class="icon-box"></td>
                        <td><b>${d.name}</b></td>
                        <td style="text-align:left;">
                            <button onclick="editFolderUI('${f.key}','${d.name}')" class="btn btn-outline" style="padding:5px 10px;">ØªØ¹Ø¯ÙŠÙ„</button>
                            <button onclick="del('folders/${f.key}')" class="btn btn-danger" style="padding:5px 10px;"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>`;
                });
                document.getElementById('foldersList').innerHTML = html;
                document.getElementById('videoFolderSelect').innerHTML = opts;
                document.getElementById('examFolderSelect').innerHTML = opts;
            });

            // Sync Students
            onValue(ref(db, 'students'), snap => {
                let html = "";
                snap.forEach(s => {
                    const d = s.val();
                    html += `<tr><td>${d.name}</td><td>${d.grade}</td>
                    <td><a href="https://wa.me/${d.whatsapp}" target="_blank" style="color:var(--success)"><i class="fab fa-whatsapp"></i> ${d.whatsapp}</a></td>
                    <td><span class="btn-outline" style="padding:2px 8px; border-radius:5px; font-size:0.7rem;">Ù†Ø´Ø·</span></td>
                    <td><button onclick="del('students/${s.key}')" style="border:none; color:var(--danger); cursor:pointer;"><i class="fas fa-user-times"></i></button></td></tr>`;
                });
                document.getElementById('studentsList').innerHTML = html;
            });

            // Sync Results
            onValue(ref(db, 'results'), snap => {
                let html = "";
                snap.forEach(r => {
                    const d = r.val();
                    html += `<tr><td>${d.student}</td><td>${d.exam}</td><td style="color:var(--accent); font-weight:bold;">${d.score}%</td><td>${d.date || ''}</td>
                    <td><button onclick="del('results/${r.key}')" class="btn btn-danger" style="padding:5px;"><i class="fas fa-times"></i></button></td></tr>`;
                });
                document.getElementById('resultsList').innerHTML = html;
            });

            // Sync Reviews
            onValue(ref(db, 'reviews'), snap => {
                let html = "";
                snap.forEach(r => {
                    html += `<div class="card" style="border-right:4px solid var(--accent);">
                        <div style="font-weight:bold; color:var(--accent);">${r.val().student}</div>
                        <div style="margin:10px 0; font-style:italic;">"${r.val().text}"</div>
                        <button onclick="del('reviews/${r.key}')" class="btn btn-danger" style="width:100%; font-size:0.8rem;">Ø­Ø°Ù Ø§Ù„Ø±Ø£ÙŠ</button>
                    </div>`;
                });
                document.getElementById('reviewsGrid').innerHTML = html;
            });
        }

        // Folder Functions
        window.saveFolder = async () => {
            const id = document.getElementById('editFolderId').value, name = document.getElementById('folderName').value, file = document.getElementById('folderFile').files[0];
            if(!name) return;
            const btn = document.getElementById('saveFolderBtn'); btn.disabled = true;

            let data = { name };
            if(file) {
                const reader = new FileReader();
                reader.onloadend = async () => {
                    data.img = reader.result;
                    id ? await update(ref(db, `folders/${id}`), data) : await push(ref(db, 'folders'), data);
                    resetFolderForm();
                };
                reader.readAsDataURL(file);
            } else {
                id ? await update(ref(db, `folders/${id}`), data) : alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù„Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø¬Ø¯ÙŠØ¯");
                resetFolderForm();
            }
        };

        window.editFolderUI = (id, name) => {
            document.getElementById('editFolderId').value = id;
            document.getElementById('folderName').value = name;
            document.getElementById('courseFormTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§Ù„ÙŠ";
            document.getElementById('saveFolderBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
        };

        function resetFolderForm() {
            document.getElementById('editFolderId').value = ""; document.getElementById('folderName').value = "";
            document.getElementById('folderFile').value = ""; document.getElementById('saveFolderBtn').disabled = false;
            document.getElementById('courseFormTitle').innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ Ø¬Ø¯ÙŠØ¯";
            document.getElementById('saveFolderBtn').innerText = "Ø­ÙØ¸ Ø§Ù„Ù…Ø¬Ù„Ø¯";
        }

        // Video & Exam Functions
        window.addVideo = () => {
            const fId = document.getElementById('videoFolderSelect').value, t = document.getElementById('videoTitle').value, u = document.getElementById('videoUrl').value;
            if(fId && t && u) push(ref(db, `folders/${fId}/videos`), { title: t, url: u }).then(() => alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±"));
        };

        window.loadVideosForExam = async () => {
            const fId = document.getElementById('examFolderSelect').value, vSel = document.getElementById('examVideoSelect');
            vSel.innerHTML = '<option value="all">Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„ Ù„Ù„ÙƒÙˆØ±Ø³</option>';
            const snap = await get(ref(db, `folders/${fId}/videos`));
            snap.forEach(v => { vSel.innerHTML += `<option value="${v.key}">${v.val().title}</option>`; });
        };

        window.addQuestion = (type) => {
            const d = document.createElement('div');
            d.className = "card"; d.style = "background:#fcfcff; position:relative; border:1px solid #eee;";
            d.innerHTML = `<i class="fas fa-trash-alt" style="position:absolute; left:15px; top:15px; color:var(--danger); cursor:pointer;" onclick="this.parentElement.remove()"></i>
            <input type="text" class="q-txt" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
            ${type==='mcq' ? `<div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px;"><input type="text" class="oA" placeholder="Ø®ÙŠØ§Ø± A"><input type="text" class="oB" placeholder="Ø®ÙŠØ§Ø± B"><input type="text" class="oC" placeholder="Ø®ÙŠØ§Ø± C"><input type="text" class="oD" placeholder="Ø®ÙŠØ§Ø± D"></div>` : ''}
            <select class="q-cor" style="margin-top:10px;"><option value="A">${type==='mcq'?'Ø§Ù„ØµØ­: A':'ØµØ­'}</option><option value="B">${type==='mcq'?'Ø§Ù„ØµØ­: B':'Ø®Ø·Ø£'}</option>${type==='mcq'?'<option value="C">Ø§Ù„ØµØ­: C</option><option value="D">Ø§Ù„ØµØ­: D</option>':''}</select>`;
            document.getElementById('qBuilder').appendChild(d);
        };

        window.publishExam = () => {
            const fId = document.getElementById('examFolderSelect').value, n = document.getElementById('examTitle').value, vRel = document.getElementById('examVideoSelect').value;
            const qCards = document.querySelectorAll('#qBuilder .card');
            let qs = [];
            qCards.forEach(c => {
                qs.push({ text: c.querySelector('.q-txt').value, options: { A: c.querySelector('.oA')?.value || "ØµØ­", B: c.querySelector('.oB')?.value || "Ø®Ø·Ø£", C: c.querySelector('.oC')?.value || "-", D: c.querySelector('.oD')?.value || "-" }, correct: c.querySelector('.q-cor').value });
            });
            if(fId && n && qs.length) push(ref(db, `quizzes/${fId}`), { name: n, videoRel: vRel, questions: qs }).then(() => { alert("ØªÙ… Ø§Ù„Ù†Ø´Ø±"); document.getElementById('qBuilder').innerHTML = ""; document.getElementById('examTitle').value = ""; });
        };

        // Navigation
        window.showSection = (id, btn) => {
            document.querySelectorAll('.admin-section').forEach(s => s.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            btn.classList.add('active');
        };

        window.adminLogout = () => signOut(auth);
window.del = (path) => { if(confirm("Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠØŸ")) remove(ref(db, path)); };
    </script>
</body>
</html>