<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ms. Mona | Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --main: #6c5ce7; --dark: #4834d4; --bg: #f4f4f9; --danger: #ff7675; --success: #2ecc71; --whatsapp: #25d366; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); padding: 20px; color: #333; }
        
        #adminDashboard { display: none; max-width: 1100px; margin: 0 auto; }
        .card { background: white; padding: 25px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
        h2 { color: var(--dark); font-size: 1.3rem; margin-bottom: 15px; border-right: 5px solid var(--main); padding-right: 10px; text-align: right; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; font-family: 'Cairo'; }
        button { background: var(--main); color: white; border: none; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.3s; }
        button:hover { background: var(--dark); }
        
        .tab-menu { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
        .tab-menu button { background: #fff; color: var(--main); border: 1px solid var(--main); min-width: 120px; }
        .tab-menu button.active { background: var(--main); color: white; }
        
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; background: white; }
        th, td { padding: 12px; text-align: center; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; color: var(--main); }
        
        .course-manage-card { border: 1px solid #eee; padding: 15px; border-radius: 12px; margin-bottom: 15px; background: #fff; }
        .video-item { display: flex; justify-content: space-between; align-items: center; background: #f9f9fb; padding: 8px 15px; margin: 5px 0; border-radius: 8px; font-size: 0.9rem; }
        
        .delete-btn { background: var(--danger); width: auto; padding: 5px 12px; font-size: 0.8rem; }
        .edit-btn { background: #f1c40f; width: auto; padding: 5px 12px; font-size: 0.8rem; margin-left: 5px; }
        
        .question-builder { background: #f0f0ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid var(--main); position: relative; }
        .remove-q-btn { position: absolute; top: 10px; left: 10px; background: #ff7675; color: white; border: none; width: 25px; height: 25px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; }
        
        .opt-input { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        .wa-link { color: var(--whatsapp); text-decoration: none; font-weight: bold; }
        
        #loadingOverlay { display:flex; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(255,255,255,0.9); z-index:9999; flex-direction:column; align-items:center; justify-content:center; }
    </style>
</head>
<body>

    <div id="loadingOverlay">
        <i class="fas fa-user-shield fa-spin fa-3x" style="color:var(--main)"></i>
        <p style="margin-top:15px; font-weight:bold;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©...</p>
    </div>

    <div id="adminDashboard">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© | Ms. Mona ğŸ’</h1>
            <button onclick="window.location.href='index.html'" style="width:auto; background:#636e72;">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>
        </div>

        <div class="tab-menu">
            <button onclick="showTab('coursesTab', this)" class="active"><i class="fas fa-book"></i> Ø§Ù„ÙƒÙˆØ±Ø³Ø§Øª</button>
            <button onclick="showTab('examsTab', this)"><i class="fas fa-edit"></i> Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø±</button>
            <button onclick="showTab('studentsTab', this)"><i class="fas fa-users"></i> Ø§Ù„Ø·Ù„Ø§Ø¨</button>
            <button onclick="showTab('resultsTab', this)"><i class="fas fa-poll"></i> Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            <button onclick="showTab('reviewsTab', this)"><i class="fas fa-star"></i> Ø§Ù„Ø¢Ø±Ø§Ø¡</button>
        </div>

        <div id="coursesTab" class="tab-content">
            <div class="card">
                <h2 id="courseFormTitle">Ø¥Ù†Ø´Ø§Ø¡ / ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ±Ø³</h2>
                <input type="hidden" id="editCourseId">
                <input type="text" id="courseName" placeholder="Ø§Ø³Ù… Ø§Ù„ÙƒÙˆØ±Ø³">
                <p style="font-size: 0.8rem; color: #666;">Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ù„Ù„ÙƒÙˆØ±Ø³ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„)</p>
                <input type="file" id="courseImgFile" accept="image/*">
                <div style="display:flex; gap:10px;">
                    <button id="saveCourseBtn" onclick="saveCourse()">Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ±Ø³</button>
                    <button id="cancelEditBtn" onclick="resetCourseForm()" style="display:none; background:#ccc;">Ø¥Ù„ØºØ§Ø¡</button>
                </div>
            </div>

            <div class="card">
                <h2>Ø¥Ø¶Ø§ÙØ© ÙÙŠØ¯ÙŠÙˆ Ø¬Ø¯ÙŠØ¯</h2>
                <select id="targetCourseSelect"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option></select>
                <input type="text" id="videoTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ">
                <input type="text" id="videoLink" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ÙŠÙˆØªÙŠÙˆØ¨">
                <button onclick="addVideoToCourse()" style="background:var(--success);">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
            </div>

            <div id="coursesListAdmin"></div>
        </div>

        <div id="examsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø¬Ø¯ÙŠØ¯</h2>
                <label>Ø§Ù„ÙƒÙˆØ±Ø³ Ø§Ù„ØªØ§Ø¨Ø¹ Ù„Ù‡:</label>
                <select id="quizFolderSelect" onchange="loadVideosForQuiz(this.value)"><option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option></select>
                
                <label>Ø±Ø¨Ø· Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† Ø¨Ù€ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                <select id="quizVideoSelect"><option value="all">ÙƒÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ (Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„)</option></select>
                
                <input type="text" id="quizName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø§Ù…ØªØ­Ø§Ù† (Ù…Ø«Ø§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø´Ù‡Ø± Ø£ÙƒØªÙˆØ¨Ø±)">
                <hr style="margin:20px 0;">
                <div id="questionsArea"></div>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:15px;">
                    <button onclick="addNewQuestionUI('mcq')" style="background:#55efc4;">+ Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø±ÙŠ</button>
                    <button onclick="addNewQuestionUI('tf')" style="background:#81ecec;">+ Ø³Ø¤Ø§Ù„ ØµØ­/Ø®Ø·Ø£</button>
                </div>
                
                <button onclick="saveWrittenQuiz()" style="background:var(--dark); font-size:1.1rem;">ğŸš€ Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ù„Ù„Ø·Ù„Ø§Ø¨</button>
            </div>
        </div>

        <div id="studentsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ø§Ø³Ù…</th>
                                <th>Ø§Ù„ØµÙ</th>
                                <th>ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>ÙˆØ§ØªØ³Ø§Ø¨ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</th>
                                <th>Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody id="studentsListBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="resultsTab" class="tab-content" style="display:none;">
            <div class="card"><h2>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</h2><div class="table-container"><table><thead><tr><th>Ø§Ù„Ø·Ø§Ù„Ø¨</th><th>Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th><th>Ø­Ø°Ù</th></tr></thead><tbody id="resultsList"></tbody></table></div></div>
        </div>

        <div id="reviewsTab" class="tab-content" style="display:none;">
            <div class="card">
                <h2>Ø¢Ø±Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨</th>
                                <th>Ø§Ù„Ø±Ø£ÙŠ</th>
                                <th>Ø­Ø°Ù</th>
                            </tr>
                        </thead>
                        <tbody id="reviewsListBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, remove, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA8KQAQgu4nIiomoDpoTLnBz_uAtab63sY",
            databaseURL: "https://monaacademy-cd983-default-rtdb.firebaseio.com",
            projectId: "monaacademy-cd983",
            storageBucket: "monaacademy-cd983.appspot.com",
            appId: "1:410646694761:web:bea49c51d3b0ff5eb9cbf8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);
        let qCount = 0;

        onAuthStateChanged(auth, (user) => {
            if (user && user.email === "mrsmonakamel6@gmail.com") {
                document.getElementById('loadingOverlay').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                loadData();
            } else { window.location.href = "index.html"; }
        });

        // ØªØµØ­ÙŠØ­ 1: ÙØµÙ„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø­Ø¯ÙˆØ« Loop Ù„Ø§Ù†Ù‡Ø§Ø¦ÙŠ
        function loadData() {
            onValue(ref(db, 'folders'), (snap) => {
                const s1 = document.getElementById('targetCourseSelect'), 
                      s2 = document.getElementById('quizFolderSelect'),
                      list = document.getElementById('coursesListAdmin');
                
                // Ø­ÙØ¸ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹ Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø³Ø­ Ù„Ø¹Ø¯Ù… Ù…Ø¶Ø§ÙŠÙ‚Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
                const currentS1 = s1.value;
                const currentS2 = s2.value;

                s1.innerHTML = s2.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ÙƒÙˆØ±Ø³...</option>';
                list.innerHTML = "";
                
                snap.forEach(c => {
                    const d = c.val();
                    s1.innerHTML += `<option value="${c.key}" ${currentS1 === c.key ? 'selected' : ''}>${d.name}</option>`;
                    s2.innerHTML += `<option value="${c.key}" ${currentS2 === c.key ? 'selected' : ''}>${d.name}</option>`;
                    
                    let vHtml = "";
                    if(d.videos){
                        Object.keys(d.videos).forEach(vk => {
                            vHtml += `<div class="video-item">
                                <span><i class="fab fa-youtube"></i> ${d.videos[vk].title}</span>
                                <button class="delete-btn" onclick="window.del('folders/${c.key}/videos/${vk}')">Ø­Ø°Ù Ø§Ù„ÙÙŠØ¯ÙŠÙˆ</button>
                            </div>`;
                        });
                    }

                    list.innerHTML += `
                        <div class="course-manage-card">
                            <div style="display:flex; justify-content:space-between; align-items:center;">
                                <h3>${d.name}</h3>
                                <div>
                                    <button class="edit-btn" onclick="window.startEditCourse('${c.key}', '${d.name}')">ØªØ¹Ø¯ÙŠÙ„</button>
                                    <button class="delete-btn" onclick="window.del('folders/${c.key}')">Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ±Ø³</button>
                                </div>
                            </div>
                            <div style="margin-top:10px; border-top:1px solid #eee; padding-top:10px;">
                                ${vHtml || '<p style="font-size:0.8rem; color:#999;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª</p>'}
                            </div>
                        </div>`;
                });
            });

            onValue(ref(db, 'students'), (snap) => {
                const b = document.getElementById('studentsListBody'); b.innerHTML = "";
                snap.forEach(s => { 
                    const d = s.val(); 
                    b.innerHTML += `
                        <tr>
                            <td>${d.name || 'Ù…Ø¬Ù‡ÙˆÙ„'}</td>
                            <td>${d.grade || '-'}</td>
                            <td><a href="https://wa.me/${d.whatsapp}" target="_blank" class="wa-link"><i class="fab fa-whatsapp"></i> ${d.whatsapp || '-'}</a></td>
                            <td><a href="https://wa.me/${d.parentPhone}" target="_blank" class="wa-link" style="color:#e67e22;"><i class="fab fa-whatsapp"></i> ${d.parentPhone || 'ØºÙŠØ± Ù…Ø³Ø¬Ù„'}</a></td>
                            <td><button class="delete-btn" onclick="window.del('students/${s.key}')">Ø­Ø°Ù</button></td>
                        </tr>`; 
                });
            });

            onValue(ref(db, 'results'), (snap) => {
                const l = document.getElementById('resultsList'); l.innerHTML = "";
                snap.forEach(c => { const r = c.val(); l.innerHTML += `<tr><td>${r.student}</td><td>${r.exam}</td><td>${r.score}%</td><td><button class="delete-btn" onclick="window.del('results/${c.key}')">Ø­Ø°Ù</button></td></tr>`; });
            });

            onValue(ref(db, 'reviews'), (snap) => {
                const b = document.getElementById('reviewsListBody'); b.innerHTML = "";
                snap.forEach(s => {
                    const d = s.val();
                    b.innerHTML += `<tr><td>${d.student || d.name}</td><td>${d.text}</td><td><button class="delete-btn" onclick="window.del('reviews/${s.key}')">Ø­Ø°Ù</button></td></tr>`;
                });
            });
        }

        window.loadVideosForQuiz = (fId) => {
            const vSelect = document.getElementById('quizVideoSelect');
            vSelect.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ (Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„)</option>';
            if(!fId) return;
            onValue(ref(db, `folders/${fId}/videos`), (snap) => {
                vSelect.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ (Ø§Ù…ØªØ­Ø§Ù† Ø´Ø§Ù…Ù„)</option>';
                snap.forEach(v => { vSelect.innerHTML += `<option value="${v.key}">${v.val().title}</option>`; });
            }, { onlyOnce: true });
        }

        window.addNewQuestionUI = (type) => {
            qCount++;
            const div = document.createElement('div');
            div.className = 'question-builder';
            // ØªØµØ­ÙŠØ­: Ø¬Ø¹Ù„ Ø²Ø± Ø§Ù„Ø­Ø°Ù ÙŠØ¹Ù…Ù„ Ø¨Ø´ÙƒÙ„ Ø³Ù„ÙŠÙ… Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹
            const removeId = 'q_block_' + Date.now();
            div.id = removeId;
            const deleteBtn = `<button class="remove-q-btn" onclick="document.getElementById('${removeId}').remove()">X</button>`;
            
            if(type === 'mcq') {
                div.innerHTML = deleteBtn + `<input type="hidden" class="q-type" value="mcq">
                    <strong>Ø³Ø¤Ø§Ù„ Ø§Ø®ØªÙŠØ§Ø±ÙŠ</strong>
                    <input type="text" class="q-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
                    <div class="opt-input">
                        <input type="text" class="opt-a" placeholder="Ø®ÙŠØ§Ø± A"> <input type="text" class="opt-b" placeholder="Ø®ÙŠØ§Ø± B">
                        <input type="text" class="opt-c" placeholder="Ø®ÙŠØ§Ø± C"> <input type="text" class="opt-d" placeholder="Ø®ÙŠØ§Ø± D">
                    </div>
                    <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:</label>
                    <select class="q-correct"><option value="A">A</option><option value="B">B</option><option value="C">C</option><option value="D">D</option></select>`;
            } else {
                div.innerHTML = deleteBtn + `<input type="hidden" class="q-type" value="tf">
                    <strong>Ø³Ø¤Ø§Ù„ ØµØ­/Ø®Ø·Ø£</strong>
                    <input type="text" class="q-text" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„">
                    <select class="q-correct"><option value="A">ØµØ­ (True)</option><option value="B">Ø®Ø·Ø£ (False)</option></select>
                    <input type="hidden" class="opt-a" value="ØµØ­ (True)"> <input type="hidden" class="opt-b" value="Ø®Ø·Ø£ (False)">
                    <input type="hidden" class="opt-c" value="-"> <input type="hidden" class="opt-d" value="-">`;
            }
            document.getElementById('questionsArea').appendChild(div);
        };

        window.saveCourse = async () => {
            const nameInput = document.getElementById('courseName');
            const fileInput = document.getElementById('courseImgFile');
            const editId = document.getElementById('editCourseId').value;
            const name = nameInput.value.trim();
            const file = fileInput.files[0];
            
            if(!name) return alert("Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨");
            
            let imgData = null;
            if(file) { 
                imgData = await new Promise(r => { 
                    const rd = new FileReader(); 
                    rd.readAsDataURL(file); 
                    rd.onload = () => r(rd.result); 
                }); 
            }

            try {
                if(editId) {
                    const updateData = { name: name };
                    if(imgData) updateData.img = imgData;
                    await update(ref(db, 'folders/' + editId), updateData);
                    alert("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ù†Ø¬Ø§Ø­");
                } else {
                    if(!imgData) return alert("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø© Ù„Ù„ÙƒÙˆØ±Ø³ Ø§Ù„Ø¬Ø¯ÙŠØ¯");
                    await push(ref(db, 'folders'), { name, img: imgData });
                    alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ÙƒÙˆØ±Ø³ Ø¨Ù†Ø¬Ø§Ø­");
                }
                resetCourseForm();
            } catch(e) { alert("Ø­Ø¯Ø« Ø®Ø·Ø£: " + e.message); }
        };

        window.startEditCourse = (id, name) => {
            document.getElementById('editCourseId').value = id;
            document.getElementById('courseName').value = name;
            document.getElementById('courseFormTitle').innerText = "ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ±Ø³: " + name;
            document.getElementById('cancelEditBtn').style.display = "block";
            document.getElementById('saveCourseBtn').innerText = "ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª";
            window.scrollTo({top: 0, behavior: 'smooth'});
        };

        window.resetCourseForm = () => {
            document.getElementById('editCourseId').value = "";
            document.getElementById('courseName').value = "";
            document.getElementById('courseImgFile').value = "";
            document.getElementById('courseFormTitle').innerText = "Ø¥Ù†Ø´Ø§Ø¡ / ØªØ¹Ø¯ÙŠÙ„ ÙƒÙˆØ±Ø³";
            document.getElementById('cancelEditBtn').style.display = "none";
            document.getElementById('saveCourseBtn').innerText = "Ø­ÙØ¸ Ø§Ù„ÙƒÙˆØ±Ø³";
        };

        window.saveWrittenQuiz = async () => {
            const fId = document.getElementById('quizFolderSelect').value;
            const vId = document.getElementById('quizVideoSelect').value;
            const name = document.getElementById('quizName').value.trim();
            const qBlocks = document.querySelectorAll('.question-builder');
            
            if(!fId || !name || qBlocks.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø¶Ø§ÙØ© Ø³Ø¤Ø§Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");
            
            let qs = [];
            let isValid = true;
            
            qBlocks.forEach(b => {
                const text = b.querySelector('.q-text').value.trim();
                if(!text) isValid = false;
                qs.push({
                    text: text,
                    options: { 
                        A: b.querySelector('.opt-a').value || 'Ø®ÙŠØ§Ø± A', 
                        B: b.querySelector('.opt-b').value || 'Ø®ÙŠØ§Ø± B', 
                        C: b.querySelector('.opt-c').value || '-', 
                        D: b.querySelector('.opt-d').value || '-' 
                    },
                    correct: b.querySelector('.q-correct').value
                });
            });

            if(!isValid) return alert("ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©");

            try {
                await push(ref(db, `quizzes/${fId}`), { name, videoRel: vId, questions: qs });
                alert("ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­");
                document.getElementById('questionsArea').innerHTML = "";
                document.getElementById('quizName').value = "";
            } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø´Ø±: " + e.message); }
        };

        window.addVideoToCourse = () => {
            const id = document.getElementById('targetCourseSelect').value;
            const t = document.getElementById('videoTitle').value.trim();
            const u = document.getElementById('videoLink').value.trim();
            
            if(!id || !t || !u) return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ");
            
            push(ref(db, `folders/${id}/videos`), { title: t, url: u })
                .then(() => {
                    alert("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¨Ù†Ø¬Ø§Ø­");
                    document.getElementById('videoTitle').value = "";
                    document.getElementById('videoLink').value = "";
                });
        };

        window.showTab = (id, btn) => {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display='none');
            document.getElementById(id).style.display='block';
            document.querySelectorAll('.tab-menu button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        };

        window.del = (p) => {
            if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù†ØµØ± Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ ÙˆÙ„Ù† ØªØªÙ…ÙƒÙ† Ù…Ù† Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡.")) {
                remove(ref(db, p)).catch(e => alert("ÙØ´Ù„ Ø§Ù„Ø­Ø°Ù: " + e.message));
            }
        };
    </script>
</body>
</html>