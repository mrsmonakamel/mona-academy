<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="description" content="ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ูุน ุงูุฃุณุชุงุฐุฉ ููู ููุงู - ุดุฑุญ ูุจุณุทุ ุงุฎุชุจุงุฑุงุชุ ูุชุงุจุนุฉ ูุณุชูุฑุฉ">
    <meta name="theme-color" content="#6c5ce7">
    <title>Ms. Mona Kamel | English Academy</title>
    
    <!-- Preload fonts and css -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="style.css?v=2.0">
    
    <!-- Preload hero image -->
    <link rel="preload" as="image" href="mona.jpg">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://monaacademy-cd983.web.app/">
    <meta property="og:title" content="Ms. Mona Kamel | English Academy">
    <meta property="og:description" content="ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ูุน ุงูุฃุณุชุงุฐุฉ ููู ููุงู - ุดุฑุญ ูุจุณุทุ ุงุฎุชุจุงุฑุงุช ุชูุงุนููุฉุ ูุชุงุจุนุฉ ูุณุชูุฑุฉ">
    <meta property="og:image" content="https://monaacademy-cd983.web.app/mona.jpg">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://monaacademy-cd983.web.app/">
    <meta property="twitter:title" content="Ms. Mona Kamel | English Academy">
    <meta property="twitter:description" content="ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ูุน ุงูุฃุณุชุงุฐุฉ ููู ููุงู">
    <meta property="twitter:image" content="https://monaacademy-cd983.web.app/mona.jpg">
    
    <!-- PWA Meta Tags -->
<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Mona Academy">
<link rel="apple-touch-icon" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png">
<link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-152x152.png">
<meta name="msapplication-TileImage" content="/icons/icon-144x144.png">
<meta name="msapplication-TileColor" content="#6c5ce7">
    
    <style>
        /* ุงูุฃููุงุท ุงูุญุฑุฌุฉ ููุท */
        .skeleton { background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: skeleton-loading 1.5s infinite; border-radius: 10px; min-height: 200px; }
        @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        .offline-indicator { position: fixed; top: 0; left: 0; right: 0; background: #ff7675; color: white; text-align: center; padding: 8px; font-size: 0.9rem; z-index: 10000; transform: translateY(-100%); transition: transform 0.3s ease; }
        .offline-indicator.show { transform: translateY(0); }
        .progress-indicator { position: fixed; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #6c5ce7, #8b7cf0); z-index: 10001; transform: scaleX(0); transform-origin: 0 0; transition: transform 0.3s ease; }
        .progress-indicator.loading { transform: scaleX(1); }
        .toast-container { position: fixed; top: 20px; left: 20px; z-index: 10000; pointer-events: none; }
    </style>
</head>
<body>
    <!-- Progress Indicator -->
    <div id="progressIndicator" class="progress-indicator"></div>
    
    <!-- Offline Indicator -->
    <div id="offlineIndicator" class="offline-indicator">
        <i class="fas fa-wifi-slash"></i>
        ุฃูุช ุบูุฑ ูุชุตู ุจุงูุฅูุชุฑูุช - ุจุนุถ ุงูููุฒุงุช ูุฏ ูุง ุชุนูู
    </div>

    <header>
        <div class="logo-text" id="logoText">MS. MONA KAMEL</div>
        <div class="header-controls">
    <div class="dark-mode-toggle" onclick="window.toggleDarkMode()">
        <i class="fas fa-moon" id="darkModeIcon"></i>
    </div>
    <div id="authStatus"></div>
</div>
    </header>

    <!-- HAMBURGER DROPDOWN -->
    <div id="menuDropdown" class="dropdown-menu">
        <a id="homeMenuItem" style="display: none;" class="touch-feedback"><i class="fas fa-home" style="margin-left: 10px;"></i> ุงูุฑุฆูุณูุฉ</a>
        <hr id="menuDivider" style="display: none;">
        <a id="logoutMenuItem" style="display: none; color: var(--danger);" class="touch-feedback"><i class="fas fa-sign-out-alt" style="margin-left: 10px;"></i> ุชุณุฌูู ุงูุฎุฑูุฌ</a>
    </div>

    <!-- SUBSCRIPTION MODAL -->
    <div id="subscriptionModal" class="subscription-modal">
        <div class="subscription-content">
            <i class="fas fa-times-circle" style="position: absolute; left: 20px; top: 20px; font-size: 1.5rem; color: #ccc; cursor: pointer;" id="closeSubscriptionBtn"></i>
            <h2 style="color: var(--main); margin-bottom: 20px;">๐ฏ ุงุดุชุฑู ูู ุงูููุฑุณ</h2>
            <div id="subCourseInfo" style="font-size: 1.2rem; font-weight: bold; margin-bottom: 20px;"></div>
            <div class="sub-option">
                <button type="button" id="previewBtn" class="sub-btn">๐๏ธ ูุดุงูุฏุฉ ุงููุญุชูู</button>
                <button type="button" id="subscribeBtn" class="sub-btn primary">โ ุงุดุชุฑุงู</button>
            </div>
            <div id="subscriptionIdSection" style="display: none;">
                <p style="color: #666; margin-bottom: 10px;">ุฃุฏุฎู ููุฏ ุงูุทุงูุจ ุงูุฎุงุต ุจู (ID) ูุชุฃููุฏ ุงูุงุดุชุฑุงู:</p>
                <input type="text" id="subscriptionIdInput" class="id-input" placeholder="1234567890" maxlength="10" inputmode="numeric" pattern="[0-9]*">
                <button type="button" id="confirmSubscribeBtn" class="auth-btn" style="width: 100%; margin-top: 10px; background: var(--main); color: white; border: none; padding: 12px; border-radius: 12px; font-weight: bold; cursor: pointer;">ุชุฃููุฏ ุงูุงุดุชุฑุงู</button>
                <div id="subError" style="color: var(--danger); margin-top: 10px; font-size: 0.9rem;"></div>
            </div>
        </div>
    </div>

    <!-- HOME PAGE -->
    <div id="homePage">
        <section class="hero">
            <div class="hero-content">
                <h1>Learn English with <br> Ms. Mona Kamel</h1>
                <p>Welcome to your second home! Everything you need to excel is right here.</p><br>
                <a href="#courses" class="btn-hero" style="background: #fff; color: var(--main); padding: 15px 35px; border-radius: 50px; text-decoration: none; font-weight: 900;">View Courses</a>
            </div>
            <div class="hero-image"><img src="mona.jpg" alt="Ms. Mona Kamel" width="300" height="300"></div>
        </section>

        <section class="about-section">
            <span class="about-tag">About Me</span>
            <div class="about-content">
                <h2>Who is Ms. Mona Kamel?</h2>
                <p>Ms. Mona Kamel is a professional English language instructor dedicated to making English learning an enjoyable and rewarding experience.</p>
            </div>
        </section>
        
        <section class="features">
            <h2>ููุงุฐุง ุชุดุชุฑู ูุนูุงุ โจ</h2>
            <div class="features-grid">
                <div class="feat-card"><div class="num-circle">1</div><h3>ุดุฑุญ ูุจุณุท</h3><p>ุจูุญูู ูู ูุงุนุฏุฉ ููู ูููุฉ ูู ุงููููุฌ ุจุฃุณููุจ ููุชุน.</p></div>
                <div class="feat-card"><div class="num-circle">2</div><h3>ุชูููููุฌูุง ุชุนููููุฉ</h3><p>ููุฏูููุงุช ุจุฌูุฏุฉ ุนุงููุฉ ูููุตุฉ ุณููุฉ ุชูุธู ูู ูุฐุงูุฑุชู.</p></div>
                <div class="feat-card"><div class="num-circle">3</div><h3>ูุชุงุจุนุฉ ูุณุชูุฑุฉ</h3><p>ุฅุญูุง ูุนุงู ุฎุทูุฉ ุจุฎุทูุฉ ููุฑุฏ ุนูู ุงุณุชูุณุงุฑุงุชู.</p></div>
            </div>
        </section>

        <!-- ููุฑุณุงุชูุง ุงูุชุนููููุฉ -->
        <section class="courses" id="courses">
            <h2 style="text-align: center; margin-bottom: 40px; font-weight: 900;">ููุฑุณุงุชูุง ุงูุชุนููููุฉ</h2>
            <div id="foldersGrid" class="course-grid">
                <!-- Skeleton Loading -->
                <div class="skeleton"></div>
                <div class="skeleton"></div>
                <div class="skeleton"></div>
            </div>
        </section>

        <!-- PERFECT SCORES SECTION -->
        <section id="perfectScoresSection" class="perfect-section" style="display: block;">
            <div class="perfect-header">
                <i class="fas fa-trophy"></i>
                <h2>ุทูุงุจ ุงูุฏุฑุฌุฉ ุงูููุงุฆูุฉ ๐</h2>
                <i class="fas fa-star"></i>
            </div>
            <div id="perfectScoresGrid" class="perfect-grid"></div>
        </section>

        <!-- ================ RAMADAN QUESTIONS SECTION ================ -->
        <section id="ramadanQuestionsSection" style="background: linear-gradient(145deg, #1a2639, #0c1a2b); padding: 60px 20px; margin: 0;">
            <div style="max-width: 900px; margin: 0 auto;">
                <!-- Header -->
                <div style="text-align: center; margin-bottom: 40px;">
                    <div style="font-size: 3rem; margin-bottom: 10px;">๐</div>
                    <h2 style="color: #ffd700; font-size: 2.2rem; font-weight: 900; margin-bottom: 10px;">ูุณุงุจูุฉ ุฃุณุฆูุฉ ุฑูุถุงู</h2>
                    <p style="color: rgba(255,255,255,0.7); font-size: 1rem;">ุดุงุฑู ูุญูู ุฃูุถู ุงููุชุงุฆุฌ</p>
                </div>

                <!-- ุดุฑูุท ุงููุณุงุจูุฉ -->
                <div style="background: rgba(255,215,0,0.1); border: 2px solid rgba(255,215,0,0.4); border-radius: 20px; padding: 25px; margin-bottom: 35px;">
                    <h3 style="color: #ffd700; margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                        <i class="fas fa-scroll"></i> ุดุฑูุท ุงููุณุงุจูุฉ
                    </h3>
                    <div style="color: rgba(255,255,255,0.85); line-height: 2; font-size: 0.95rem;">
                        <p>๐ข ูุชู ุงูุงุฎุชูุงุฑ ุนุดูุงุฆู .. ููุชู ุงูุชูุงุตู ุนู ุทุฑูู ุฑูู ุงููุงุชู ุงููุณุฌู.</p>
                        <p>๐ ุดุฑุท ุฃู ูุชู ุฅุฑุณุงู ุฅุฌุงุจุงุช ุงูุฃุณุฆูุฉ ูุชุชุงููุฉ ูููุงูุฉ ุงูุดูุฑ ูุน ุญูุธ ุขูุงุช ุงูุตูุงู ุจุณูุฑุฉ ุงูุจูุฑุฉ ููุนุฑูุฉ ุชูุณูุฑูุง ูู ุชูุณูุฑ ุงุจู ูุซูุฑ .. (ุขูุฉ ูกูจูฃุ ูกูจูคุ ูกูจูฅ)</p>
                        <p>๐น ูุญุธ ุณุนูุฏ ููุฌููุน</p>
                    </div>
                </div>

                <!-- ุงูุฃุณุฆูุฉ -->
                <div id="ramadanQuestionsContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(260px, 1fr)); gap: 20px;">
                    <div style="text-align: center; color: rgba(255,255,255,0.5); grid-column: 1/-1; padding: 40px;">
                        <i class="fas fa-moon fa-3x" style="color: rgba(255,215,0,0.3); margin-bottom: 15px;"></i>
                        <p>ุฌุงุฑู ุชุญููู ุงูุฃุณุฆูุฉ...</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- ================ RAMADAN ANSWER MODAL ================ -->
        <div id="ramadanAnswerModal" style="display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.75); z-index: 5000; align-items: center; justify-content: center; padding: 20px;">
            <div style="background: linear-gradient(145deg, #1a2639, #0c1a2b); border: 2px solid #ffd700; border-radius: 30px; max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto; padding: 30px; position: relative;">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px;">
                    <h3 id="ramadanQuestionTitle" style="color: #ffd700; font-size: 1.3rem; font-weight: 900; flex: 1; margin-left: 15px;"></h3>
                    <span onclick="document.getElementById('ramadanAnswerModal').style.display='none'" style="color: rgba(255,255,255,0.5); font-size: 1.8rem; cursor: pointer; line-height: 1; flex-shrink: 0;">&times;</span>
                </div>
                <div id="ramadanQuestionText" style="color: white; font-size: 1.05rem; margin-bottom: 25px; line-height: 1.9; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px;"></div>

                <div>
                    <div style="margin-bottom: 12px;">
                        <label style="color: #ffd700; font-size: 0.9rem; display: block; margin-bottom: 6px;"><i class="fas fa-user"></i> ุงูุงุณู ุงูุซูุงุซู</label>
                        <input type="text" id="ramadanAnswerName" placeholder="ุฃุฏุฎู ุงุณูู ุงูุซูุงุซู" maxlength="50"
                            style="width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: white; font-family: 'Cairo', sans-serif; font-size: 0.95rem; outline: none;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="color: #ffd700; font-size: 0.9rem; display: block; margin-bottom: 6px;"><i class="fas fa-id-card"></i> ููุฏ ุงูุทุงูุจ (10 ุฃุฑูุงู)</label>
                        <input type="text" id="ramadanStudentId" placeholder="0000000000" maxlength="10" inputmode="numeric"
                            style="width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: white; font-family: 'Cairo', sans-serif; font-size: 0.95rem; outline: none; direction: ltr;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="color: #ffd700; font-size: 0.9rem; display: block; margin-bottom: 6px;"><i class="fas fa-book-open"></i> ุงุฎุชุฑ ุงูุณูุฑุฉ</label>
                        <select id="ramadanSurahSelect"
                            style="width: 100%; padding: 12px 15px; background: rgba(20,30,50,0.95); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: white; font-family: 'Cairo', sans-serif; font-size: 0.95rem; outline: none;">
                            <option value="">-- ุงุฎุชุฑ ุงูุณูุฑุฉ --</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="color: #ffd700; font-size: 0.9rem; display: block; margin-bottom: 6px;"><i class="fas fa-hashtag"></i> ุฑูู ุงูุขูุฉ</label>
                        <input type="number" id="ramadanAyaInput" placeholder="ูุซุงู: 183" min="1"
                            style="width: 100%; padding: 12px 15px; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,215,0,0.3); border-radius: 12px; color: white; font-family: 'Cairo', sans-serif; font-size: 0.95rem; outline: none; direction: ltr;">
                    </div>

                    <div id="ramadanSubmitMsg" style="display:none; margin-bottom: 12px; padding: 12px; border-radius: 10px; font-weight: 700; text-align: center;"></div>

                    <button type="button" id="ramadanSubmitAnswerBtn"
                        style="width: 100%; padding: 14px; background: linear-gradient(135deg, #ffd700, #ffa500); border: none; border-radius: 14px; color: #1a2639; font-weight: 900; font-size: 1.1rem; cursor: pointer; font-family: 'Cairo', sans-serif; transition: 0.3s;">
                        <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ
                    </button>
                </div>

                <div style="margin-top: 25px; border-top: 1px solid rgba(255,215,0,0.15); padding-top: 20px;">
                    <h4 style="color: #ffd700; margin-bottom: 12px; font-size: 0.95rem;"><i class="fas fa-users"></i> ุฅุฌุงุจุงุช ุงููุดุงุฑููู</h4>
                    <div id="ramadanAnswersContainer" style="max-height: 200px; overflow-y: auto;"></div>
                </div>
            </div>
        </div>

        <!-- REVIEWS SECTION -->
        <section class="reviews">
            <h2 style="margin-bottom: 40px; font-weight: 900;">ูุงููุง ุนู Ms. Mona Kamel โจ</h2>
            <div class="reviews-grid" id="testiGrid"></div>
            <div id="reviewSectionContainer"></div>
        </section>
    </div>

    <!-- COURSE CONTENT AREA -->
    <div id="contentArea" style="display: none;">
        <button type="button" id="backToHomeBtn" style="background:#f0eeff; color:var(--main); border:none; padding:10px 25px; border-radius:15px; cursor:pointer; font-weight:bold; margin-bottom:25px; font-family:'Cairo';">
            <i class="fas fa-arrow-right"></i> ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
        </button>
        <h2 id="folderTitleName" style="margin-bottom:30px; color:var(--dark); text-align:center; font-weight: 900;"></h2>
      
<!-- ุญุงููุฉ ุฑุงุจุท ูุฌููุนุฉ ูุงุชุณุงุจ -->
<div id="whatsappGroupContainer" style="margin-bottom: 20px;"></div>
  
        <!-- Rating Section -->
        <div id="courseRatingSection" class="rating-box" style="display: none;"></div>
        
        <div id="combinedGrid" class="content-grid"></div>
    </div>
    
    
           <!-- ุญุงููุฉ ุงููุงุฌุจุงุช -->
        <div id="assignmentsContainer" style="margin-top: 30px;"></div>

    <!-- QUIZ / VIDEO OVERLAY -->
    <div id="quizOverlay">
        <div class="quiz-header">
            <h2 id="quizTitle" style="font-weight: 900; color: var(--main);"></h2>
            <button type="button" id="closeQuizBtn" style="background:var(--danger); color:white; border:none; padding:8px 20px; border-radius:10px; cursor:pointer; font-weight:bold; font-family:'Cairo';">ุฅุบูุงู</button>
        </div>
        <div id="quizContainer" style="max-width: 800px; margin: 0 auto; padding-bottom: 100px;"></div>
    </div>

    <!-- LOGIN & REGISTRATION MODAL -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" id="closeLoginBtn">&times;</span>
            
            <!-- ุดุงุดุฉ ุงุฎุชูุงุฑ ุชุณุฌูู ุฏุฎูู / ุญุณุงุจ ุฌุฏูุฏ -->
            <div id="authChoice">
                <h2 style="color:var(--main); margin-bottom:20px;">ูุฑุญุจุงู ุจู ๐</h2>
                <button type="button" class="auth-btn" id="showLoginChoiceBtn" style="width:100%; margin-bottom:10px; background:var(--main); color:white; border:none; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <button type="button" class="auth-btn" id="showRegisterBtn" style="background:#fff; color:var(--main); border:2px solid var(--main); width:100%; margin-bottom:10px; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ
                </button>
            </div>
            
            <!-- ุดุงุดุฉ ุงุฎุชูุงุฑ ุทุฑููุฉ ุชุณุฌูู ุงูุฏุฎูู -->
            <div id="loginChoice" style="display:none;">
                <h2 style="color:var(--main); margin-bottom:20px;">ุงุฎุชุฑ ุทุฑููุฉ ุชุณุฌูู ุงูุฏุฎูู</h2>
                <button type="button" class="auth-btn" id="showLoginEmailBtn" style="width:100%; margin-bottom:10px; background:var(--main); color:white; border:none; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุงูุฏุฎูู ุจุงูุฅูููู ูุงูุจุงุณูุฑุฏ
                </button>
                <button type="button" class="auth-btn" id="showLoginUsernameBtn" style="background:#fff; color:var(--main); border:2px solid var(--main); width:100%; margin-bottom:10px; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุงูุฏุฎูู ุจุงูููุฒุฑ ููู ูุงูุจุงุณูุฑุฏ
                </button>
                <button type="button" class="auth-btn" id="loginGoogleBtn" style="background:#fff; color:#444; border:1px solid #ddd; width:100%; display:flex; align-items:center; justify-content:center; gap:10px; cursor:pointer; padding:12px; border-radius:12px; font-weight:bold;">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="20" alt="Google"> 
                    ุงูุฏุฎูู ุจูุงุณุทุฉ ุฌูุฌู
                </button>
                <p id="backToChoiceFromLogin" style="margin-top:15px; cursor:pointer; font-size:0.8rem; color:var(--main);">ุงูุนูุฏุฉ ููุฎูู</p>
            </div>
            
            <!-- ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู ุจุงูุฅูููู -->
            <div id="loginEmail" style="display:none; text-align:right;">
                <h2 style="color:var(--main); margin-bottom:20px;">ุงูุฏุฎูู ุจุงูุฅูููู ูุงูุจุงุณูุฑุฏ</h2>
                <input type="email" id="stEmail" class="reg-input" placeholder="example@email.com" dir="ltr" inputmode="email" name="email">
                <input type="password" id="stPass" class="reg-input" placeholder="ูููุฉ ุงููุฑูุฑ" name="password">
                <button type="button" class="auth-btn" id="loginEmailSubmitBtn" style="width:100%; margin-top:15px; background:var(--main); color:white; border:none; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <p id="backToLoginChoiceFromEmail" style="margin-top:15px; cursor:pointer; font-size:0.8rem; color:var(--main);;">ุงูุนูุฏุฉ ููุฎูู</p>
            </div>
            
            <!-- ูููุฐุฌ ุชุณุฌูู ุงูุฏุฎูู ุจุงูููุฒุฑ ููู -->
            <div id="loginUsername" style="display:none; text-align:right;">
                <h2 style="color:var(--main); margin-bottom:20px;">ุงูุฏุฎูู ุจุงูููุฒุฑ ููู ูุงูุจุงุณูุฑุฏ</h2>
                <input type="text" id="stUsername" class="reg-input" placeholder="ุงุณู ุงููุณุชุฎุฏู" dir="ltr" inputmode="text" name="username">
                <input type="password" id="stPassUsername" class="reg-input" placeholder="ูููุฉ ุงููุฑูุฑ" name="password">
                <button type="button" class="auth-btn" id="loginUsernameSubmitBtn" style="width:100%; margin-top:15px; background:var(--main); color:white; border:none; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                    ุชุณุฌูู ุงูุฏุฎูู
                </button>
                <p id="backToLoginChoiceFromUsername" style="margin-top:15px; cursor:pointer; font-size:0.8rem; color:var(--main);;">ุงูุนูุฏุฉ ููุฎูู</p>
            </div>
            
            <!-- ูููุฐุฌ ุงูุชุณุฌูู (3 ุฎุทูุงุช) -->
            <div id="registerForm" style="display:none; text-align:right;">
                <h2 style="color:var(--main); margin-bottom:20px;">ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h2>
                
                <!-- ุดุฑูุท ุงูุชูุฏู -->
                <div class="progress-bar">
                    <div class="progress-fill" id="regProgress" style="width:33%;"></div>
                </div>
                
                <!-- ุงูุฎุทูุฉ 1: ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ -->
                <div id="step1" class="step-container active">
                    <h3 style="color:var(--dark); margin-bottom:15px;">๐ ุงูุฎุทูุฉ 1: ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ</h3>
                    
                    <label class="reg-label required-field">ุงูุงุณู ุงูุฑุจุงุนู</label>
                    <div class="name-grid">
                        <input type="text" id="n1" class="reg-input" placeholder="ุงูุฃูู" maxlength="50" inputmode="text" name="firstname">
                        <input type="text" id="n2" class="reg-input" placeholder="ุงูุซุงูู" maxlength="50" inputmode="text" name="middlename1">
                        <input type="text" id="n3" class="reg-input" placeholder="ุงูุซุงูุซ" maxlength="50" inputmode="text" name="middlename2">
                        <input type="text" id="n4" class="reg-input" placeholder="ุงูุฑุงุจุน" maxlength="50" inputmode="text" name="lastname">
                    </div>
                    
                    <label class="reg-label required-field">ุฑูู ุงููุงุชุณุงุจ</label>
                    <div class="phone-row">
                        <select id="countryCode" class="country-select" name="countrycode">
                            <option value="+20">+20 (ูุตุฑ)</option>
                            <option value="+966">+966 (ุงูุณุนูุฏูุฉ)</option>
                            <option value="+971">+971 (ุงูุฅูุงุฑุงุช)</option>
                            <option value="+974">+974 (ูุทุฑ)</option>
                            <option value="+965">+965 (ุงููููุช)</option>
                            <option value="+973">+973 (ุงูุจุญุฑูู)</option>
                            <option value="+968">+968 (ุนูุงู)</option>
                            <option value="+962">+962 (ุงูุฃุฑุฏู)</option>
                            <option value="+970">+970 (ููุณุทูู)</option>
                        </select>
                        <input type="tel" id="regWhatsapp" class="reg-input" placeholder="1234567890" maxlength="15" style="flex:1;" inputmode="numeric" pattern="[0-9]*" name="whatsapp">
                    </div>
                    <div class="hint-text">ุฃุฏุฎู ุงูุฑูู ุจุฏูู ููุชุงุญ ุงูุฏููุฉ</div>
                    
                    <label class="reg-label">ุฑูู ููู ุงูุฃูุฑ (ุงุฎุชูุงุฑู)</label>
                    <div class="phone-row">
                        <select id="parentCountryCode" class="country-select" name="parentcountrycode">
                            <option value="+20">+20 (ูุตุฑ)</option>
                            <option value="+966">+966 (ุงูุณุนูุฏูุฉ)</option>
                            <option value="+971">+971 (ุงูุฅูุงุฑุงุช)</option>
                        </select>
                        <input type="tel" id="regParentPhone" class="reg-input" placeholder="1234567890" maxlength="15" style="flex:1;" inputmode="numeric" pattern="[0-9]*" name="parentphone">
                    </div>
                    
                    <div id="step1Error" class="error-message" style="display:none;"></div>
                    
                    <button type="button" id="step1NextBtn" class="btn btn-main" style="margin-top:20px; width:100%;" disabled>
                        ุงูุชุงูู <i class="fas fa-arrow-left"></i>
                    </button>
                </div>
                
                <!-- ุงูุฎุทูุฉ 2: ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ -->
                <div id="step2" class="step-container">
                    <h3 style="color:var(--dark); margin-bottom:15px;">๐ ุงูุฎุทูุฉ 2: ุงููุฑุญูุฉ ุงูุฏุฑุงุณูุฉ</h3>
                    
                    <label class="reg-label required-field">ุงููุฑุญูุฉ ุงูุชุนููููุฉ</label>
                    <select id="regLevel" class="reg-input" name="level">
                        <option value="">-- ุงุฎุชุฑ ุงููุฑุญูุฉ --</option>
                        <option value="primary">ุงููุฑุญูุฉ ุงูุงุจุชุฏุงุฆูุฉ</option>
                        <option value="middle">ุงููุฑุญูุฉ ุงูุฅุนุฏุงุฏูุฉ</option>
                        <option value="secondary">ุงููุฑุญูุฉ ุงูุซุงูููุฉ</option>
                    </select>
                    
                    <label class="reg-label required-field">ุงูุตู ุงูุฏุฑุงุณู</label>
                    <select id="regGrade" class="reg-input" name="grade">
                        <option value="">-- ุงุฎุชุฑ ุงูุตู ุฃููุงู --</option>
                    </select>
                    
                    <div id="step2Error" class="error-message" style="display:none;"></div>
                    
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <button type="button" id="step2PrevBtn" class="btn" style="background:#eee; color:var(--text-primary); flex:1;">
                            <i class="fas fa-arrow-right"></i> ุงูุณุงุจู
                        </button>
                        <button type="button" id="step2NextBtn" class="btn btn-main" style="flex:2;" disabled>
                            ุงูุชุงูู <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>
                </div>
                
                <!-- ุงูุฎุทูุฉ 3: ุงุฎุชูุงุฑ ุทุฑููุฉ ุงูุชุณุฌูู -->
                <div id="step3" class="step-container">
                    <h3 style="color:var(--dark); margin-bottom:15px;">๐ ุงูุฎุทูุฉ 3: ุทุฑููุฉ ุงูุชุณุฌูู</h3>
                    
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <button type="button" id="showRegEmailBtn" class="btn" style="flex:1; background:#f0eeff; color:var(--main); border:1px solid var(--main);">
                            <i class="fas fa-envelope"></i> ุฅูููู
                        </button>
                        <button type="button" id="showRegUsernameBtn" class="btn" style="flex:1; background:#f0eeff; color:var(--main); border:1px solid var(--main);">
                            <i class="fas fa-user"></i> ููุฒุฑ ููู
                        </button>
                    </div>
                    
                    <!-- ุงูุชุณุฌูู ุจุงูุฅูููู -->
                    <div id="step3Email" class="step-container" style="display:none;">
                        <input type="email" id="regEmail" class="reg-input" placeholder="example@email.com" dir="ltr" inputmode="email" name="email">
                        <input type="password" id="regPass" class="reg-input" placeholder="ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ูุฃูุซุฑ)" name="password">
                        <input type="password" id="regPassConfirm" class="reg-input" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ" name="password_confirm">
                        <button type="button" id="regBtn" class="btn btn-main" style="width:100%; margin-top:15px;">
                            ุชุณุฌูู
                        </button>
                    </div>
                    
                    <!-- ุงูุชุณุฌูู ุจููุฒุฑ ููู -->
                    <div id="step3Username" class="step-container" style="display:none;">
                        <input type="text" id="regUsername" class="reg-input" placeholder="ุงุณู ุงููุณุชุฎุฏู" dir="ltr" inputmode="text" name="username">
                        <input type="password" id="regPassUser" class="reg-input" placeholder="ูููุฉ ุงููุฑูุฑ (6 ุฃุญุฑู ูุฃูุซุฑ)" name="password">
                        <input type="password" id="regPassUserConfirm" class="reg-input" placeholder="ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ" name="password_confirm">
                        <button type="button" id="regBtnUser" class="btn btn-main" style="width:100%; margin-top:15px;" disabled>
                            ุชุณุฌูู
                        </button>
                    </div>
                    
                    <!-- ุงูุชุณุฌูู ุจุฌูุฌู -->
                    <button type="button" id="registerGoogleBtn" class="auth-btn" style="background:#fff; color:#444; border:1px solid #ddd; width:100%; display:flex; align-items:center; justify-content:center; gap:10px; margin-top:15px; padding:12px; border-radius:12px; font-weight:bold; cursor:pointer;">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" width="20" alt="Google">
                        ุงูุชุณุฌูู ุจุฌูุฌู
                    </button>
                    
                    <div style="display:flex; gap:10px; margin-top:20px;">
                        <button type="button" id="step3PrevBtn" class="btn" style="background:#eee; color:var(--text-primary); flex:1;">
                            <i class="fas fa-arrow-right"></i> ุงูุณุงุจู
                        </button>
                        <button type="button" id="step3CancelBtn" class="btn" style="background:var(--danger); color:white; flex:1;">
                            ุฅูุบุงุก
                        </button>
                    </div>
                </div>
                
                <p id="backToChoiceFromRegister" style="margin-top:15px; cursor:pointer; font-size:0.8rem; color:var(--main); text-align:center;">ุงูุนูุฏุฉ ููุฎูู</p>
            </div>
        </div>
    </div>

    <!-- WHATSAPP MODAL -->
    <div id="waModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">ุชูุงุตู ูุน Ms. Mona</h3>
            <a href="https://wa.me/201026298954" class="social-btn wa" style="display:block; margin-bottom:10px;" target="_blank">01026298954</a>
            <a href="https://wa.me/201128874885" class="social-btn wa" style="display:block;" target="_blank">01128874885</a>
            <button type="button" id="closeWaModalBtn" style="margin-top: 15px; border: none; background: none; color: var(--danger); cursor: pointer; font-family:'Cairo';">ุฅุบูุงู</button>
        </div>
    </div>

    <footer>
        <p>ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ ูขููขูฆ | <strong>Ms. Mona Kamel</strong></p>
        <div style="margin-top: 20px; display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
            <a href="https://www.facebook.com/share/1C9MoP8pqj/" class="social-btn fb" target="_blank">
                <i class="fab fa-facebook-f" style="margin-left: 5px;"></i> ููุณุจูู
            </a>
            <div class="social-btn wa" id="showWaModalBtn">
                <i class="fab fa-whatsapp" style="margin-left: 5px;"></i> ูุงุชุณุงุจ
            </div>
            <a href="https://wa.me/2010 91640622" class="social-btn developer-btn" target="_blank">
                <i class="fas fa-code" style="margin-left: 5px;"></i> Developed by Abdelrahman Adawi
            </a>
        </div>
    </footer>

        <!-- Toast Container ููุฅุดุนุงุฑุงุช -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- ุงุณุชูุฑุงุฏ ุงูุณูุฑูุจุช ุงูุฑุฆูุณู -->
    <script type="module" src="script.js?v=2.1"></script>

    <!-- ุงุณุชูุฑุงุฏ ุงูุณูุฑูุจุชุงุช ุงููุณุงุนุฏุฉ -->
    <script src="notifications.js?v=1.0"></script>
    <script src="badges.js?v=1.0"></script>
    <script src="maintenance.js?v=1.0"></script>
    <script src="whatsapp-group.js?v=1.0"></script>

    <script>
        // ุงูุชุญูู ูู ูุถุน ุงูุตูุงูุฉ ุจุนุฏ ุชุญููู ุงููููุงุช
        (async function() {
            if (typeof window.checkMaintenanceMode === 'function') {
                const isMaintenance = await window.checkMaintenanceMode();
                if (isMaintenance) {
                    // ุชู ุนุฑุถ ุตูุญุฉ ุงูุตูุงูุฉุ ูููู ุงูุชุญููู
                    return;
                }
            }
            console.log('โ ุชู ุชุฌุงูุฒ ูุถุน ุงูุตูุงูุฉ');
        })();

        // ุชุญุณููุงุช ุชุฌุฑุจุฉ ุงููุณุชุฎุฏู (Offline Detection, Skeleton, ุฑุจุท ุงูุฃุญุฏุงุซ)
        function updateOnlineStatus() {
            const indicator = document.getElementById('offlineIndicator');
            if (indicator) {
                indicator.classList.toggle('show', !navigator.onLine);
            }
        }
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();

        window.addEventListener('load', () => {
            setTimeout(() => {
                document.querySelectorAll('.skeleton').forEach(el => el.remove());
            }, 1000);
        });

        document.addEventListener('DOMContentLoaded', function() {
            // ุฑุจุท ุฃุฒุฑุงุฑ ุงููุงุชุณุงุจ
            const showWaModalBtn = document.getElementById('showWaModalBtn');
            const closeWaModalBtn = document.getElementById('closeWaModalBtn');
            const waModal = document.getElementById('waModal');
            if (showWaModalBtn) {
                showWaModalBtn.addEventListener('click', function() {
                    if (waModal) waModal.style.display = 'flex';
                });
            }
            if (closeWaModalBtn) {
                closeWaModalBtn.addEventListener('click', function() {
                    if (waModal) waModal.style.display = 'none';
                });
            }

            // ุฑุจุท ุฃุฒุฑุงุฑ ุงูุนูุฏุฉ ููุฑุฆูุณูุฉ
            const logoText = document.getElementById('logoText');
            const backToHomeBtn = document.getElementById('backToHomeBtn');
            if (logoText) {
                logoText.addEventListener('click', function() {
                    window.location.reload();
                });
            }
            if (backToHomeBtn) {
                backToHomeBtn.addEventListener('click', function() {
                    document.getElementById('homePage').style.display = 'block';
                    document.getElementById('contentArea').style.display = 'none';
                });
            }

            // ุฑุจุท ุฃุฒุฑุงุฑ ุฅุบูุงู ุงูููุฏุงูุงุช
            const closeLoginBtn = document.getElementById('closeLoginBtn');
            const closeSubscriptionBtn = document.getElementById('closeSubscriptionBtn');
            const closeQuizBtn = document.getElementById('closeQuizBtn');
            const loginModal = document.getElementById('loginModal');
            const subscriptionModal = document.getElementById('subscriptionModal');
            const quizOverlay = document.getElementById('quizOverlay');
            if (closeLoginBtn) {
                closeLoginBtn.addEventListener('click', function() {
                    if (loginModal) loginModal.style.display = 'none';
                });
            }
            if (closeSubscriptionBtn) {
                closeSubscriptionBtn.addEventListener('click', function() {
                    if (subscriptionModal) subscriptionModal.style.display = 'none';
                });
            }
            if (closeQuizBtn) {
                closeQuizBtn.addEventListener('click', function() {
                    if (quizOverlay) {
                        quizOverlay.style.display = 'none';
                        const quizContainer = document.getElementById('quizContainer');
                        if (quizContainer) quizContainer.innerHTML = "";
                    }
                });
            }

            // ุฅุบูุงู ุงูููุฏุงูุงุช ุนูุฏ ุงูุถุบุท ุฎุงุฑุฌูุง
            window.addEventListener('click', function(event) {
                if (event.target === loginModal) loginModal.style.display = 'none';
                if (event.target === subscriptionModal) subscriptionModal.style.display = 'none';
                if (event.target === waModal) waModal.style.display = 'none';
            });

            // ููุน ุงูุชูุจูุฑ ุนูู ุงูู inputs ูู ุงูููุจุงูู
            const inputs = document.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"], input[type="number"]');
            inputs.forEach(input => {
                input.addEventListener('touchstart', () => {
                    input.style.fontSize = '16px';
                });
            });
        });
    </script>

    <!-- PWA Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(reg => console.log('โ Service Worker registered with scope:', reg.scope))
                    .catch(err => console.log('โ Service Worker registration failed:', err));
            });
        }
    </script>
        <!-- ASSIGNMENT OVERLAY -->
    <div id="assignmentOverlay" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="quiz-header">
                <h2 id="assignmentTitle"></h2>
                <button type="button" onclick="closeAssignmentOverlay()" style="background:var(--danger); color:white; border:none; padding:8px 20px; border-radius:10px;">ุฅุบูุงู</button>
            </div>
            <div id="assignmentContainer" style="max-height: 80vh; overflow-y: auto;"></div>
        </div>
    </div>
    <script src="assignments.js?v=1.0"></script>

    <!-- ================ RAMADAN JS ================ -->
    <script>
    (function() {
        const SURAHS = ["ุงููุงุชุญุฉ","ุงูุจูุฑุฉ","ุขู ุนูุฑุงู","ุงููุณุงุก","ุงููุงุฆุฏุฉ","ุงูุฃูุนุงู","ุงูุฃุนุฑุงู","ุงูุฃููุงู","ุงูุชูุจุฉ","ูููุณ","ููุฏ","ููุณู","ุงูุฑุนุฏ","ุฅุจุฑุงููู","ุงูุญุฌุฑ","ุงููุญู","ุงูุฅุณุฑุงุก","ุงูููู","ูุฑูู","ุทู","ุงูุฃูุจูุงุก","ุงูุญุฌ","ุงููุคูููู","ุงูููุฑ","ุงููุฑูุงู","ุงูุดุนุฑุงุก","ุงูููู","ุงููุตุต","ุงูุนููุจูุช","ุงูุฑูู","ูููุงู","ุงูุณุฌุฏุฉ","ุงูุฃุญุฒุงุจ","ุณุจุฃ","ูุงุทุฑ","ูุณ","ุงูุตุงูุงุช","ุต","ุงูุฒูุฑ","ุบุงูุฑ","ูุตูุช","ุงูุดูุฑู","ุงูุฒุฎุฑู","ุงูุฏุฎุงู","ุงูุฌุงุซูุฉ","ุงูุฃุญูุงู","ูุญูุฏ","ุงููุชุญ","ุงูุญุฌุฑุงุช","ู","ุงูุฐุงุฑูุงุช","ุงูุทูุฑ","ุงููุฌู","ุงูููุฑ","ุงูุฑุญูู","ุงููุงูุนุฉ","ุงูุญุฏูุฏ","ุงููุฌุงุฏูุฉ","ุงูุญุดุฑ","ุงูููุชุญูุฉ","ุงูุตู","ุงูุฌูุนุฉ","ุงูููุงูููู","ุงูุชุบุงุจู","ุงูุทูุงู","ุงูุชุญุฑูู","ุงูููู","ุงูููู","ุงูุญุงูุฉ","ุงููุนุงุฑุฌ","ููุญ","ุงูุฌู","ุงููุฒูู","ุงููุฏุซุฑ","ุงูููุงูุฉ","ุงูุฅูุณุงู","ุงููุฑุณูุงุช","ุงููุจุฃ","ุงููุงุฒุนุงุช","ุนุจุณ","ุงูุชูููุฑ","ุงูุงููุทุงุฑ","ุงููุทูููู","ุงูุงูุดูุงู","ุงูุจุฑูุฌ","ุงูุทุงุฑู","ุงูุฃุนูู","ุงูุบุงุดูุฉ","ุงููุฌุฑ","ุงูุจูุฏ","ุงูุดูุณ","ุงูููู","ุงูุถุญู","ุงูุดุฑุญ","ุงูุชูู","ุงูุนูู","ุงููุฏุฑ","ุงูุจููุฉ","ุงูุฒูุฒูุฉ","ุงูุนุงุฏูุงุช","ุงููุงุฑุนุฉ","ุงูุชูุงุซุฑ","ุงูุนุตุฑ","ุงูููุฒุฉ","ุงูููู","ูุฑูุด","ุงููุงุนูู","ุงูููุซุฑ","ุงููุงูุฑูู","ุงููุตุฑ","ุงููุณุฏ","ุงูุฅุฎูุงุต","ุงูููู","ุงููุงุณ"];

        let currentQuestionId = null;

        // ุชุญููู ุงูุณูุฑ ูู ุงูู select
        function fillSurahSelect() {
            const sel = document.getElementById('ramadanSurahSelect');
            if (!sel) return;
            SURAHS.forEach((s, i) => {
                const opt = document.createElement('option');
                opt.value = i + 1;
                opt.textContent = `${i + 1}. ุณูุฑุฉ ${s}`;
                sel.appendChild(opt);
            });
        }

        // ุชุญููู ุงูุฃุณุฆูุฉ ูู Firebase
        function loadRamadanQuestions() {
            const container = document.getElementById('ramadanQuestionsContainer');
            if (!container) return;

            function tryLoad() {
                if (!window.db || !window.ref || !window.onValue) {
                    setTimeout(tryLoad, 300);
                    return;
                }
                window.onValue(window.ref(window.db, 'ramadan_questions'), (snapshot) => {
                    if (!snapshot.exists()) {
                        container.innerHTML = '<div style="text-align:center;color:rgba(255,255,255,0.4);grid-column:1/-1;padding:40px;"><i class="fas fa-moon fa-3x" style="margin-bottom:15px;display:block;"></i>ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ุญุงููุงู</div>';
                        return;
                    }
                    const questions = [];
                    snapshot.forEach(child => {
                        questions.push({ id: child.key, ...child.val() });
                    });
                    questions.sort((a, b) => (a.day || 0) - (b.day || 0));
                    renderQuestions(questions);
                });
            }
            tryLoad();
        }

        function renderQuestions(questions) {
            const container = document.getElementById('ramadanQuestionsContainer');
            if (!container) return;
            let html = '';
            questions.forEach(q => {
                const isActive = q.isActive !== false;
                html += `
                <div onclick="window.openRamadanQuestion('${q.id}')" style="
                    background: rgba(255,255,255,0.05);
                    border: 2px solid ${isActive ? '#ffd700' : 'rgba(255,255,255,0.1)'};
                    border-radius: 20px; padding: 20px; cursor: pointer;
                    transition: all 0.3s; position: relative; overflow: hidden;
                    ${!isActive ? 'opacity: 0.5;' : ''}
                " onmouseover="this.style.transform='translateY(-5px)';this.style.background='rgba(255,215,0,0.1)'"
                   onmouseout="this.style.transform='';this.style.background='rgba(255,255,255,0.05)'">
                    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
                        <div style="background: linear-gradient(135deg, #ffd700, #ffa500); width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center; font-weight:900; color:#1a2639; font-size:1rem; flex-shrink:0;">
                            ${q.day || '?'}
                        </div>
                        <div>
                            <div style="color:#ffd700;font-weight:700;font-size:0.85rem;">ุงูููู ${q.day || '?'}</div>
                            <div style="color:rgba(255,255,255,0.5);font-size:0.75rem;">${isActive ? 'โ ูุชุงุญ' : '๐ ูุบูู'}</div>
                        </div>
                    </div>
                    <p style="color:white;font-size:0.9rem;line-height:1.7;margin:0;">${window.escapeHTML ? window.escapeHTML(q.text || '') : (q.text || '')}</p>
                </div>`;
            });
            container.innerHTML = html || '<div style="text-align:center;color:rgba(255,255,255,0.4);grid-column:1/-1;padding:40px;">ูุง ุชูุฌุฏ ุฃุณุฆูุฉ ุญุงููุงู</div>';
        }

        window.openRamadanQuestion = function(questionId) {
            function tryOpen() {
                if (!window.db || !window.ref || !window.get) { setTimeout(tryOpen, 300); return; }
                window.get(window.ref(window.db, `ramadan_questions/${questionId}`)).then(snap => {
                    if (!snap.exists()) return;
                    const q = snap.val();
                    currentQuestionId = questionId;
                    document.getElementById('ramadanQuestionTitle').textContent = `ุณุคุงู ุงูููู ${q.day || ''}`;
                    document.getElementById('ramadanQuestionText').textContent = q.text || '';
                    document.getElementById('ramadanAnswerName').value = '';
                    document.getElementById('ramadanStudentId').value = '';
                    document.getElementById('ramadanSurahSelect').value = '';
                    document.getElementById('ramadanAyaInput').value = '';
                    const msg = document.getElementById('ramadanSubmitMsg');
                    if (msg) msg.style.display = 'none';
                    loadQuestionAnswers(questionId);
                    document.getElementById('ramadanAnswerModal').style.display = 'flex';
                });
            }
            tryOpen();
        };

        function loadQuestionAnswers(questionId) {
            const container = document.getElementById('ramadanAnswersContainer');
            if (!container || !window.db) return;
            window.onValue(window.ref(window.db, 'ramadan_answers'), (snap) => {
                if (!snap.exists()) { container.innerHTML = '<p style="color:rgba(255,255,255,0.4);font-size:0.85rem;text-align:center;">ูุง ุชูุฌุฏ ุฅุฌุงุจุงุช ุจุนุฏ</p>'; return; }
                const answers = [];
                snap.forEach(child => {
                    const d = child.val();
                    if (d.questionId === questionId) answers.push(d);
                });
                if (answers.length === 0) { container.innerHTML = '<p style="color:rgba(255,255,255,0.4);font-size:0.85rem;text-align:center;">ูุง ุชูุฌุฏ ุฅุฌุงุจุงุช ุจุนุฏ</p>'; return; }
                container.innerHTML = answers.slice(-10).reverse().map(a => `
                    <div style="background:rgba(255,255,255,0.05);border-radius:10px;padding:10px 12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center;">
                        <div>
                            <span style="color:white;font-size:0.85rem;font-weight:600;">${window.escapeHTML ? window.escapeHTML(a.name || '') : ''}</span>
                            <span style="color:rgba(255,255,255,0.4);font-size:0.75rem;margin-right:8px;">${a.date || ''}</span>
                        </div>
                        <span style="font-size:0.8rem;padding:3px 10px;border-radius:50px;background:${a.isCorrect ? 'rgba(0,184,148,0.2)' : 'rgba(255,118,117,0.2)'};color:${a.isCorrect ? '#00b894' : '#ff7675'};">${a.isCorrect ? 'โ ุตุญูุญ' : 'โ ุฎุทุฃ'}</span>
                    </div>
                `).join('');
            });
        }

        // ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ
        document.addEventListener('DOMContentLoaded', function() {
            fillSurahSelect();
            loadRamadanQuestions();

            const submitBtn = document.getElementById('ramadanSubmitAnswerBtn');
            if (submitBtn) {
                submitBtn.addEventListener('click', async function() {
                    const name = document.getElementById('ramadanAnswerName').value.trim();
                    const studentId = document.getElementById('ramadanStudentId').value.trim();
                    const surahVal = document.getElementById('ramadanSurahSelect').value;
                    const ayaVal = document.getElementById('ramadanAyaInput').value.trim();
                    const msg = document.getElementById('ramadanSubmitMsg');

                    function showMsg(text, ok) {
                        if (!msg) return;
                        msg.textContent = text;
                        msg.style.background = ok ? 'rgba(0,184,148,0.2)' : 'rgba(255,118,117,0.2)';
                        msg.style.color = ok ? '#00b894' : '#ff7675';
                        msg.style.border = `1px solid ${ok ? '#00b894' : '#ff7675'}`;
                        msg.style.display = 'block';
                    }

                    if (!name) { showMsg('โ ุฃุฏุฎู ุงุณูู ุงูุซูุงุซู', false); return; }
                    if (!/^\d{10}$/.test(studentId)) { showMsg('โ ููุฏ ุงูุทุงูุจ ูุฌุจ ุฃู ูููู 10 ุฃุฑูุงู', false); return; }
                    if (!surahVal) { showMsg('โ ุงุฎุชุฑ ุงูุณูุฑุฉ', false); return; }
                    if (!ayaVal || isNaN(ayaVal) || parseInt(ayaVal) < 1) { showMsg('โ ุฃุฏุฎู ุฑูู ุงูุขูุฉ', false); return; }
                    if (!currentQuestionId || !window.db) { showMsg('โ ุญุฏุซ ุฎุทุฃุ ุฃุนุฏ ุงููุญุงููุฉ', false); return; }

                    submitBtn.disabled = true;
                    submitBtn.textContent = 'ุฌุงุฑู ุงูุฅุฑุณุงู...';

                    try {
                        // ุฌูุจ ุงูุณุคุงู ููุชุญูู ูู ุงูุฅุฌุงุจุฉ
                        const qSnap = await window.get(window.ref(window.db, `ramadan_questions/${currentQuestionId}`));
                        const q = qSnap.exists() ? qSnap.val() : {};
                        const isCorrect = String(q.surah) === String(surahVal) && String(q.aya) === String(ayaVal);

                        await window.push(window.ref(window.db, 'ramadan_answers'), {
                            questionId: currentQuestionId,
                            day: q.day || null,
                            name,
                            studentId,
                            surah: parseInt(surahVal),
                            surahName: SURAHS[parseInt(surahVal) - 1] || '',
                            aya: parseInt(ayaVal),
                            isCorrect,
                            date: new Date().toLocaleDateString('ar-EG'),
                            timestamp: Date.now()
                        });

                        showMsg(isCorrect ? '๐ ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุฃุญุณูุช' : 'โ ุฅุฌุงุจุฉ ุฎุงุทุฆุฉุ ุญุงูู ูุฑุฉ ุฃุฎุฑู', isCorrect);
                        if (isCorrect) {
                            document.getElementById('ramadanAnswerName').value = '';
                            document.getElementById('ramadanStudentId').value = '';
                            document.getElementById('ramadanSurahSelect').value = '';
                            document.getElementById('ramadanAyaInput').value = '';
                        }
                    } catch (err) {
                        showMsg('โ ูุดู ุงูุฅุฑุณุงูุ ุชุญูู ูู ุงูุงุชุตุงู', false);
                        console.error(err);
                    } finally {
                        submitBtn.disabled = false;
                        submitBtn.innerHTML = '<i class="fas fa-paper-plane"></i> ุฅุฑุณุงู ุงูุฅุฌุงุจุฉ';
                    }
                });
            }
        });
    })();
    </script>
</html>